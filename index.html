<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coder Dojo</title>
  <style>
  body{
    margin:0;
    padding:0;
  }
  </style>
</head>
<body>
<script type="text/javascript" src="js/phaser.min.js"></script>
<script>
  var game = new Phaser.Game(840, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

  function preload() {

    game.load.image('sky', 'assets/bg.png');
    game.load.image('grassMid', 'assets/Tiles/grassHalfMid.png');
    game.load.image('grassLeft', 'assets/Tiles/grassHalfLeft.png');
    game.load.image('grassRight', 'assets/Tiles/grassHalfRight.png');
    game.load.image('ground', 'assets/Tiles/grass.png');
    game.load.image('coinBronze', 'assets/Items/coinBronze.png');
    game.load.image('coinGold', 'assets/Items/coinGold.png');
    game.load.image('cloud', 'assets/Items/cloud1.png');
    game.load.atlasJSONArray('player','assets/Player/p1_walk/p1_walk.png', 'assets/Player/p1_walk/p1_walk.json');

  }

  var platforms,
      tilesprite,
      cursors,
      ground,
      player,
      platform,
      score = 0;

  function create(){
    // enable physics for the game
    game.physics.startSystem(Phaser.Physics.ARCADE);
    // add the sky as TileSprite for repetition
    tilesprite = game.add.tileSprite(0,0,840,600,'sky');
    // add ground to the game
    ground = game.add.tileSprite(0,game.world.height-70,840,70,'ground'); 
    // add player to the game
    player = game.add.sprite(72,game.world.height-167,'player');
    player.animations.add('walk',[0,1,2,3,4,5,6,7,8,9,10], 30, true, true);
    player.anchor.setTo(.5, .5); //so it flips around its middle
    // add random clouds
    game.add.sprite(0,0,'cloud');

    platforms = game.add.group();
    platforms.enableBody = true;
    coins = game.add.group();
    coins.enableBody = true;

    // enable physics for game elements
    game.physics.enable([ ground, player, platforms, coins ], Phaser.Physics.ARCADE);

    ground.body.collideWorldBounds = true;
    ground.body.immovable = true;
    ground.body.allowGravity = false;

    player.body.bounce.y = 0.2;
    player.body.gravity.y = 300;
    player.body.collideWorldBounds = true;

    // game.add.sprite(0,0,'coinGold');
    for(var i = 0 ; i < 5 ; i++){
      var coin = coins.create(500+i*70, 330, 'coinBronze');
    }
    for(var i = 0 ; i < 6 ; i++){
      var coin = coins.create(200+i*70, 130, 'coinGold');
    }
    platform = game.add.tileSprite(200, 200, 400, 70,'grassMid');
    var ledge = platforms.add(platform);
    ledge.body.immovable = true;
    platform = game.add.tileSprite(500, 400, 400, 70,'grassMid');
    var ledge = platforms.add(platform);
    ledge.body.immovable = true;

    // save keyboard inputs into variable
    cursors = game.input.keyboard.createCursorKeys();

    scoreText = game.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#000' });

  }

  function update(){
    // check for collision
    game.physics.arcade.collide(player, ground);
    game.physics.arcade.collide(player, platforms);
    // add coin player collision
    game.physics.arcade.overlap(player, coins, collectCoin, null, this);
    //if no key pressed stay still
    player.body.velocity.x = 0;
    /* move background and ground on camera pan */
    if (cursors.left.isDown){
        tilesprite.tilePosition.x += 4;
        ground.tilePosition.x += 1;

        player.scale.x = -1; //facing default direction
        player.body.velocity.x = -100;
        player.animations.play('walk');
    }
    else if (cursors.right.isDown){
        tilesprite.tilePosition.x -= 4;
        ground.tilePosition.x -= 1;

        player.scale.x = 1; //flipped
        player.body.velocity.x = 100;
        player.animations.play('walk');
    }else{
      player.animations.stop();
      player.frame = 4;
    }

    if (cursors.up.isDown && player.body.touching.down)
    {
        player.body.velocity.y = -350;
    }

    if (cursors.up.isDown){
        tilesprite.tilePosition.y += 4;
    }
    else if (cursors.down.isDown){
        tilesprite.tilePosition.y -= 4;
    }
  }

  function collectCoin(player,coin){
    switch(coin.key){
      case 'coinBronze':
        score += 10;
      break;
      case 'coinGold':
        score += 20;
      break;
    }
    coin.kill();

    scoreText.text = 'Score: ' + score;
  }
</script>
</body>
</html>